<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Negative Integer Literals - smirking teapot</title><link rel="icon" type="image/png" href=https://glados-418.github.io/icons/favicon.png /><meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:title" content="Negative Integer Literals" />
<meta property="og:description" content="TL;DR: Write your negative numbers in base-10 and wrap them in parentheses.
 negative numbers are represented in two&rsquo;s complement form and, implicit type conversion of a 32-bit integer to 64-bit integer preserves the value." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://glados-418.github.io/posts/negative-integer-literals/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-14T17:18:54+05:30" />
<meta property="article:modified_time" content="2023-06-14T17:18:54+05:30" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Negative Integer Literals"/>
<meta name="twitter:description" content="TL;DR: Write your negative numbers in base-10 and wrap them in parentheses.
 negative numbers are represented in two&rsquo;s complement form and, implicit type conversion of a 32-bit integer to 64-bit integer preserves the value."/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="https://glados-418.github.io/css/normalize.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="https://glados-418.github.io/css/main.css" /><link rel="stylesheet" type="text/css" href="https://glados-418.github.io/css/dark.css" media="(prefers-color-scheme: dark)" />

  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <script src="https://glados-418.github.io/js/main.js"></script>
</head>

<body>
  <div class="container wrapper post">
    <div class="header">
  <base href="https://glados-418.github.io/">
  <h1 class="site-title"><a href="https://glados-418.github.io/">smirking teapot</a></h1>
  <div class="site-description"><h2>yet another blog for notes and validation. outlet is optional.</h2><nav class="nav social">
      <ul class="flat"><a href="https://github.com/GLaDOS-418" title="github"><i data-feather="github"></i></a><a href="https://twitter.com/GLaDOS418" title="twitter"><i data-feather="twitter"></i></a></ul>
    </nav>
  </div>

  <nav class="nav">
    <ul class="flat">
      
      <li>
        <a href="/">home</a>
      </li>
      
      <li>
        <a href="/posts">posts</a>
      </li>
      
      <li>
        <a href="/tags">tags</a>
      </li>
      
    </ul>
  </nav>
</div>


    <div class="post-header">
      <h1 class="title">Negative Integer Literals</h1>
      <div class="meta">Posted at &mdash; Jun 14, 2023</div>
    </div>

    <div class="markdown">
      <p><em><strong>TL;DR: Write your negative numbers in base-10 and wrap them in parentheses.</strong></em></p>
<ol>
<li>negative numbers are represented in two&rsquo;s complement form and,</li>
<li>implicit type conversion of a 32-bit integer to 64-bit integer preserves the value.</li>
</ol>
<p>With the above knowledge, you&rsquo;d expect that the functions <code>f</code> and <code>g</code> below would return the same value, <code>-1</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#dc322f">long</span> <span style="color:#268bd2">f</span><span style="color:#719e07">()</span> <span style="color:#719e07">{</span> <span style="color:#719e07">return</span> <span style="color:#719e07">-</span>1<span style="color:#719e07">;</span> <span style="color:#719e07">}</span>
<span style="color:#dc322f">long</span> <span style="color:#268bd2">g</span><span style="color:#719e07">()</span> <span style="color:#719e07">{</span> <span style="color:#719e07">return</span> 0xffffffff<span style="color:#719e07">;</span> <span style="color:#719e07">}</span>
</code></pre></div><p>And you&rsquo;d be correct&hellip; if you&rsquo;re writing your code in <em>Java</em>. In most other popular languages ( like C++, Python, JavaScript, Rust, Go, Haskell, Swift &amp; Kotlin ), you&rsquo;d get the following output:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">f() : -1
g() : 4294967295
</code></pre></div><p>This was surprising for me. And until I read the references, I thought this was a bug. In my defense though, I checked on compiler explorer and found that C++ compilers behaved inconsistently under different circumstances. For example:</p>
<ol>
<li>for x86-64 architecture, MSVC returns <code>-1</code> from <code>g()</code> but, it&rsquo;s not the same with GCC or Clang. <a href="https://godbolt.org/z/77Mh8ssab">check here</a></li>
<li>for RISC-V 64-bit architecture, GCC &amp; Clang returns <code>-1</code> ( <a href="https://godbolt.org/z/dbETEKz4e">check here</a> ) and,</li>
<li>for ARM v8 64-bit architecture, Clang returns <code>-1</code> as the output of <code>g()</code> only when an optimisation is used. <a href="https://godbolt.org/z/z8EjWKPf7">check here</a></li>
</ol>
<p>So, there <em>is</em> a bug, just not where I initially thought.</p>
<p>The large positive number returned earlier is the expected behavior because in those languages there are <em><strong>NO NEGATIVE INTEGER LITERALS</strong></em>. Then what&rsquo;s the <code>-1</code> that&rsquo;s returned in <code>f()</code>? Well, that&rsquo;s a <code>unary minus expression</code>. It means that <code>-1</code> is actually <code>-(1)</code> i.e. two tokens &lt;minus&gt; &lt;integer_literal&gt;.</p>
<p>This new information helps us understand that even if a negative number is represented in two&rsquo;s-complement system internally, the languages are treating <code>0xffffffff</code> as a <em><strong>POSITIVE INTEGER LITERAL</strong></em> and since the largest positive number that can fit in a 32-bit integer is <code>0x7fffffff</code>, the literal <code>0xffffffff</code> is first coerced into a 64-bit integer then that value, <code>4294967295</code>, is returned as the result.</p>
<p>Then, what does Java do differently? In Java, while the decimal integer <code>-1</code> is a unary expression, it allows you to write two&rsquo;s-complement representation for negative integer literals in hex, oct and binary. So, <code>0xffffffff</code> is a literal, not an expression, which represents <code>-1</code>.</p>
<p>This behavior of not allowing negative integer literals is a design choice of a language. As an explanation, all I could find was that <em>&ldquo;it&rsquo;s a convention to simplify the grammar&rdquo;</em>.</p>
<p>By treating negative integer literals as expressions, while it simplifies the grammar, it now has to deal with <em><strong>operator precedence</strong></em>. Some languages like <code>Python</code>, <code>JavaScript</code>, <code>Kotlin</code> &amp; <code>Rust</code> allows method calls on integer literals which means that reality and expectations won&rsquo;t match if you don&rsquo;t surround your unary minus expression with parentheses as the operator resolution operator generally has higher precedence than unary minus operator. For example:</p>
<p>In Kotlin:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Kotlin" data-lang="Kotlin">println( -<span style="color:#2aa198">1.</span>plus(<span style="color:#2aa198">2</span>) ) <span style="color:#586e75">// prints &#39;-3&#39;
</span><span style="color:#586e75"></span>println( (-<span style="color:#2aa198">1</span>).plus(<span style="color:#2aa198">2</span>) ) <span style="color:#586e75">// prints &#39;1&#39;
</span></code></pre></div><p>In Python:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#b58900">print</span>(<span style="color:#719e07">-</span><span style="color:#2aa198">1</span> <span style="color:#719e07">.</span>__add__(<span style="color:#2aa198">2</span>))   <span style="color:#586e75"># prints -3 </span>
<span style="color:#b58900">print</span>((<span style="color:#719e07">-</span><span style="color:#2aa198">1</span>) <span style="color:#719e07">.</span>__add__(<span style="color:#2aa198">2</span>))  <span style="color:#586e75"># prints  1</span>
</code></pre></div><p>In Javascript:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#586e75">// LHS evals to string &#34;-1&#34;
</span><span style="color:#586e75"></span>console.log( ( <span style="color:#719e07">-</span><span style="color:#2aa198">1</span> ) .toString() <span style="color:#719e07">===</span> <span style="color:#719e07">-</span><span style="color:#2aa198">1</span> );    <span style="color:#586e75">// prints &#39;false&#39;
</span><span style="color:#586e75"></span>
<span style="color:#586e75">// LHS evals to int -1
</span><span style="color:#586e75"></span>console.log( <span style="color:#719e07">-</span><span style="color:#2aa198">1</span> .toString() <span style="color:#719e07">===</span> <span style="color:#719e07">-</span><span style="color:#2aa198">1</span> );       <span style="color:#586e75">// prints &#39;true&#39;
</span></code></pre></div><p>In Rust:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Rust" data-lang="Rust">println!( <span style="color:#2aa198">&#34;{}&#34;</span>, <span style="color:#719e07">-</span><span style="color:#2aa198">9</span><span style="color:#719e07">i32</span>.abs( ) );   <span style="color:#586e75">// prints -9
</span><span style="color:#586e75"></span>println!( <span style="color:#2aa198">&#34;{}&#34;</span>, (<span style="color:#719e07">-</span><span style="color:#2aa198">9</span><span style="color:#719e07">i32</span>).abs( ) ); <span style="color:#586e75">// prints  9
</span></code></pre></div><p>Then there&rsquo;s <em><strong>operator overloading</strong></em> in <code>C++</code>. But, luckily, overloaded <code>operator-</code> must have at least one parameter of class or enum type so, I can&rsquo;t overload it here for unary integer literals. <em>phew!</em></p>
<p>I&rsquo;ve added all the test codes in <a href="https://github.com/GLaDOS-418/negative_integer_literal">this github repo</a>. To add other languages, please create a pull request.</p>
<h4 id="references">References</h4>
<ul>
<li><a href="https://en.cppreference.com/w/cpp/language/integer_literal#Notes">C++ | Integer literal</a></li>
<li><a href="https://users.rust-lang.org/t/why-are-negative-value-literals-expressions/43333/5">Rust | Why are negative value literals expressions?</a></li>
<li><a href="https://discuss.kotlinlang.org/t/negative-in-integral-literals/12790">Kotlin | Negative in integral literals</a></li>
<li><a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-3.html#jls-IntegerLiteral">Java | Chapter 3. Lexical Structure | Integer Literal</a></li>
<li><a href="https://ghc.gitlab.haskell.org/ghc/doc/users_guide/exts/negative_literals.html">Haskell | 6.9.1. Negative literals</a></li>
<li><a href="https://docs.python.org/3/reference/lexical_analysis.html#numeric-literals">Python | 2. Lexical analysis</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Grammar_and_types#numeric_literals">JavaScript | Grammar and types | MDN</a></li>
</ul>

    </div>

    <div class="post-tags">
      
        
          <nav class="nav tags">
              <ul class="flat">
                
                <li><a href="/tags/programming">programming</a></li>
                
                <li><a href="/tags/programming-languages">programming-languages</a></li>
                
              </ul>
          </nav>
        
      
    </div>

  


<div id="giscus">
  <script src="https://giscus.app/client.js"
          data-repo=""
          data-repo-id=""
          data-category=""
          data-category-id=""
          data-mapping=""
          data-strict=""
          data-reactions-enabled=""
          data-emit-metadata=""
          data-input-position=""
          data-theme=""
          data-lang=""
          data-loading=""
          crossorigin=""
          async>
  </script>

  <noscript>Please enable JavaScript to view the <a href="https://giscus.app?ref_noscript">comments powered by
      Giscus.</a></noscript>

</div>


  </div>

  <div class="footer wrapper">
  <nav class="nav">
    <div> <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
  </nav>
</div>



<script async src="https://www.googletagmanager.com/gtag/js?id=G-4PLV27Q77R"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-4PLV27Q77R', { 'anonymize_ip': false });
}
</script>

<script>feather.replace()</script>

</body>
</html>
